<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <link rel="stylesheet" href="index.css" />
    <title>LIFF Starter</title>
    <script src="https://static.line-scdn.net/liff/edge/2.1/sdk.js"></script>
<!--
    <script src="https://static.line-scdn.net/liff/edge/2/non-ios-extensions_2_22_0.js" type="text/javascript"></script>
    <script src="https://static.line-scdn.net/liff/sdk/v2/liff.js"></script>
-->
  </head>
  <body>
    <style>
      #text-button {
        display: block;
        cursor: pointer;
        width: 160px;
        text-align: center;
        border: 1px solid #232323;
        padding: 10px;
      }
    </style>
    
    <h1>LINE LIFFアプリ デモ</h1>
    <p>ステータス: <span id="status">初期化中...</span></p>
    <p>あなたの表示名: <span id="display-name">情報を取得中...</span></p>

    <div id="text-button" onclick="getLiffProfile()">DisplayName</div>
    <div id="text-button" onclick="click_login()">LogIn</div>
    <div id="text-button" onclick="click_logout()">LogOut</div>

    <script>
        // ★ あなたのLIFF IDに置き換えてください
        const MY_LIFF_ID = "2008611458-kaP7KYRo"; 

        /**
         * LIFF初期化処理
         */
        function initializeLiff() {
            liff.init({
                liffId: MY_LIFF_ID
            })
            .then(() => {
                document.getElementById('status').textContent = '初期化成功';
                // LIFF初期化が成功したら、次のステップへ
                checkLoginStatus();
            })
            .catch((err) => {
                document.getElementById('status').textContent = `初期化エラー: ${err.code}`;
                console.error("LIFF Initialization failed", err);
            });
        }

        /**
         * ログイン状態の確認と処理の分岐
         */
        function checkLoginStatus() {
            if (liff.isLoggedIn()) {
                document.getElementById('status').textContent = 'ログイン済み';
                // ログインしていれば、プロフィールを取得
                getLiffProfile();
            } else {
                document.getElementById('status').textContent = '未ログイン';
                // 未ログインであれば、ログイン画面へリダイレクト
                liff.login();
            }
        }

        /**
         * liff.getProfile() API呼び出し
         */
        function getLiffProfile() {
            liff.getProfile()
            .then(profile => {
                // プロフィール情報を画面に表示
                document.getElementById('display-name').textContent = profile.displayName;
                console.log('Profile fetched:', profile);
            })
            .catch((err) => {
                document.getElementById('display-name').textContent = 'プロフィールの取得に失敗しました';
                console.error("Error getting profile", err);
            });
        }
        
        function update_status() {
            document.getElementById('status').textContent = liff.isLoggedIn() ? 'ログイン' : '未ログイン';
            getLiffProfile();
        }
        
        function click_login() {
            if (liff.isLoggedIn()) return;

            liff.login();
            update_status();
        }
        
        function click_logout() {
            if (!liff.isLoggedIn()) return;
            
            liff.logout();
            update_status();
        }

        // アプリ起動時にLIFF初期化関数を実行
        initializeLiff();
    </script>
  </body>
</html>
